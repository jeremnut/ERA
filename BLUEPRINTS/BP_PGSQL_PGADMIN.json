{"status":{},"contains_secrets":true,"product_version":"3.3.1","spec":{"description":"PG_ADMIN_STD_BUILD\nJust one more database management solution ...\nhttp:\/ip\/share","resources":{"client_attrs":{},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"91627968_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f5ddf3cc_runbook","main_task_local_reference":{"kind":"app_task","name":"91627968_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"de1b4d0a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d00b64a0_runbook","main_task_local_reference":{"kind":"app_task","name":"de1b4d0a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"71423780_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0f033308_runbook","main_task_local_reference":{"kind":"app_task","name":"71423780_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"457bd9dc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"fbcbe755_runbook","main_task_local_reference":{"kind":"app_task","name":"457bd9dc_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"16f066c1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a342d5e9_runbook","main_task_local_reference":{"kind":"app_task","name":"16f066c1_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Service1","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"vm_pgadmin"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"269a9eb9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0a8b47c1_runbook","main_task_local_reference":{"kind":"app_task","name":"269a9eb9_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"vm_pgadmin"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"459ab5b0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e511c4bb_runbook","main_task_local_reference":{"kind":"app_task","name":"459ab5b0_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"vm_pgadmin","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"cred_root"}},"os_type":"Linux","create_spec":{"name":"vm-pgadmin","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"006abae5-83ff-425e-b8dc-a015bd5edb58"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"6639980a-52b3-4eb5-b127-5272c9ede582","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"LEGACY","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"M-RLINUX84-MGMT","uuid":"bd253d57-cafa-4091-91c6-764312bb6e13"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"DISK-MGMT-80GIB","uuid":"4583c3c4-e6ec-4c01-80b2-536852680391"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"\/bc55NOoOZR9cs7S+RKkfU0RXpI0usY+B\/b24sL5Vcr1zNuViS\/n3Ota:utf-8"},"name":"cred_root","cred_class":"static"},{"username":"postgres","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"PUPKTSysVkVQIx9VbP1O9EQypUw10A+MUeEGJVQgYVeH8F+ruSjdVTku:utf-8"},"name":"cred_postgres","cred_class":"static"},{"username":"appuser","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"hTor0czHpZG5Au5SMXha0lmDtAZa8apqcHzGgR+L3VEKDEz9sOt\/bUx9:utf-8"},"name":"cred_appuser","cred_class":"static"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Service1"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"OsLinuxConfiguration"},{"kind":"app_task","name":"OsConfigureStorage"},{"kind":"app_task","name":"ConfigureUsersAndGroups"},{"kind":"app_task","name":"InstallHttpd"},{"kind":"app_task","name":"ConfigureHttp"}],"name":"bef6ae89_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"OsLinuxConfiguration"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"OsConfigureStorage"}},{"from_task_reference":{"kind":"app_task","name":"OsConfigureStorage"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"ConfigureUsersAndGroups"}},{"from_task_reference":{"kind":"app_task","name":"ConfigureUsersAndGroups"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallHttpd"}},{"from_task_reference":{"kind":"app_task","name":"InstallHttpd"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"ConfigureHttp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"OsLinuxConfiguration","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nfunction_set_security() {\n    sed -i s\/^SELINUX=.*$\/SELINUX=disabled\/ \/etc\/selinux\/config\n    setenforce 0\n    r_set_security=$(getenforce)\n    if [ $r_set_security=\"Permissive\" ]; \n        then\n            touch \/tmp\/01-web-init.log\n            echo \"###############################\" > \/tmp\/01-web-init.log\n            echo \"#           init              #\" >> \/tmp\/01-web-init.log\n            echo \"###############################\" >> \/tmp\/01-web-init.log\n            echo \"The variable selinux is fixed to $r_set_security\" >> \/tmp\/01-web-init.log\n            return 1\n        else\n            echo \"security linux not configured correctly, please check manualy\"\n            exit 1\n    fi\n}\n\nfunction_set_dns() {    \n    rm -rf \/etc\/resolv.conf\n    touch \/etc\/resolv.conf\n    echo \"#file configured using customer params\" > \/etc\/resolv.conf\n    echo \"search @@{MyDnsDomain}@@\" >> \/etc\/resolv.conf\n    echo \"nameserver @@{dns1}@@\" >> \/etc\/resolv.conf\n    echo \"nameserver @@{dns2}@@\" >> \/etc\/resolv.conf\n\n    hostnamectl set-hostname '@@{name}@@'\n\trm -rf \/etc\/hosts\n\techo -e '127.0.0.1       localhost localhost.localdomain localhost4 localhost4.localdomain4\\n@@{address}@@  @@{name}@@  @@{name}@@.@@{MyDnsDomain}@@' >> \/etc\/hosts\n    if grep -q customer \"\/etc\/resolv.conf\"; \n        then\n            touch \/tmp\/01-web-setDns.log\n            echo \"###############################\" > \/tmp\/01-web-setDns.log\n            echo \"#           dns               #\" >> \/tmp\/01-web-setDns.log\n            echo \"###############################\" >> \/tmp\/01-web-setDns.log\n            echo \"The resolv.conf file is properly configured\" >> \/tmp\/01-web-setDns.log\n            return 1\n        else\n            echo \"The resolv.conf file is not configured properly configured\"\n            exit 1\n    fi\n}\n\nfunction_set_time() {\n    dnf install chrony -y\n    rm -rf \/etc\/chrony.conf\n    touch \/etc\/chrony.conf\n    echo \"#file configured using customer params\" > \/etc\/chrony.conf\n    echo \"#time servers\" >> \/etc\/chrony.conf\n    echo \"server @@{ntp1}@@ iburst\" >> \/etc\/chrony.conf\n    echo \"server @@{dns2}@@ iburst\" >> \/etc\/chrony.conf\n    echo \"\" >> \/etc\/chrony.conf\n    echo \"# To avoid changes being made to your computer's gain\/loss compensation\" >> \/etc\/chrony.conf\n    echo \"# when the measurement history is too erratic, you might want to enable\" >> \/etc\/chrony.conf\n    echo \"# one of the following lines.  The first seems good with servers on the\" >> \/etc\/chrony.conf\n    echo \"# Internet, the second seems OK for a LAN environment.\" >> \/etc\/chrony.conf\n    echo \"maxupdateskew 100\" >> \/etc\/chrony.conf\n    echo \"\" >> \/etc\/chrony.conf\n    echo \"# Chrony likes to keep information about your computer's clock in files.\" >> \/etc\/chrony.conf\n    echo \"# The 'driftfile' stores the computer's clock gain\/loss rate in parts\" >> \/etc\/chrony.conf\n    echo \"# per million.  When chronyd starts, the system clock can be tuned\" >> \/etc\/chrony.conf\n    echo \"# immediately so that it doesn't gain or lose any more time.  You\" >> \/etc\/chrony.conf\n    echo \"# generally want this, so it is uncommented.\" >> \/etc\/chrony.conf\n    echo \"driftfile \/var\/lib\/chrony\/drift\" >> \/etc\/chrony.conf\n    if grep -q customer \"\/etc\/chrony.conf\"; \n        then\n            touch \/tmp\/01-web-setTime.log\n            echo \"###############################\" > \/tmp\/01-web-setTime.log\n            echo \"#           Time               #\" >> \/tmp\/01-web-setTime.log\n            echo \"###############################\" >> \/tmp\/01-web-setTime.log\n            echo \"The chrony.conf file is properly configured\" >> \/tmp\/01-web-setTime.log\n            systemctl start chronyd\n            systemctl enable chronyd \n            return 1\n        else\n            echo \"The chrony.conf file is not configured properly configured\"\n            exit 1\n    fi\n}\n\nfunction_set_firewall() {\n    systemctl stop firewalld\n    systemctl disable firewalld\n    touch \/tmp\/01-web-firewall.log\n    echo \"###############################\" > \/tmp\/01-web-firewall.log\n    echo \"#        Firewall             #\" >> \/tmp\/01-web-firewall.log\n    echo \"###############################\" >> \/tmp\/01-web-firewall.log\n    echo \"The firewall is disabled and is properly configured\" >> \/tmp\/01-web-firewall.log\n}\n\nmain() {\n        echo \"Configuration Security OS\"\n            if [[ -f \"\/tmp\/01-web-init.log\" ]]\n                then\n                    echo \"web Init log File is found we don't change it\"\n                    echo \"$(cat \/etc\/selinux\/config)\"\n                    echo \"------------------------------------------------------------------\"\n            else\n                function_set_security\n                echo \"content selinux\"\n                echo \"$(cat \/etc\/selinux\/config)\"\n                echo \"------------------------------------------------------------------\"\n            fi\n        echo \"Configuration Param System OS\"\n            if [[ -f \"\/tmp\/01-web-system-params.log\" ]]\n                then\n                    echo \"web System Parameters Configured, nothing to change\"\n                    echo \"$(cat \/etc\/sysctl.conf)\"\n                    echo \"$(cat \/etc\/sysconfig\/network)\"\n                    echo \"------------------------------------------------------------------\"\n            else\n                function_set_system_params\n                echo \"$(cat \/etc\/sysctl.conf)\"\n                echo \"$(cat \/etc\/sysconfig\/network)\"\n                echo \"------------------------------------------------------------------\"\n            fi\n        echo \"Configuration DNS customer\"\n            if [[ -f \"\/tmp\/01-web-setDns.log\" ]]\n                then\n                    echo \"web Dns log File is found we do not change it\"\n                    echo \"$(cat \/etc\/resolv.conf)\"\n                    echo \"------------------------------------------------------------------\"\n            else\n                function_set_dns\n                echo \"content resolv.conf\"\n                echo \"$(cat \/etc\/resolv.conf)\"\n                echo \"------------------------------------------------------------------\"\n            fi\n\n        echo \"Configuration NTP customer\"\n            if [[ -f \"\/tmp\/01-web-setTime.log\" ]]\n                then\n                    echo \"web Time log File is found we do not change it\"\n                    echo \"$(cat \/etc\/chrony.conf)\"\n                    echo \"------------------------------------------------------------------\"\n            else\n                function_set_time\n                echo \"content resolv.conf\"\n                echo \"$(cat \/etc\/chrony.conf)\"\n                echo \"------------------------------------------------------------------\"\n            fi\n\n        echo \"Configuration Firewall customer\"\n            if [[ -f \"\/tmp\/01-web-firewall.log\" ]]\n                then\n                    echo \"web Firewalld is disable we do not change it\"\n                    echo \"$(systemctl status firewalld)\"\n                    echo \"------------------------------------------------------------------\"\n            else\n                function_set_firewall\n                echo \"Desactivated Firewalld\"\n                echo \"$(systemctl status firewalld)\"\n                echo \"------------------------------------------------------------------\"\n            fi\nexit 0\n}\nmain","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"OsConfigureStorage","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nvgcreate -s 1M -v vg_pgbackup\/dev\/sdb\n#Create Logical Volume\nlvcreate -l100%FREE -v vg_pgbackup -n lv_pgbackup\n#Format\nmkfs.ext4 \/dev\/vg_pgbackup\/lv_pgbackup\n            \nmkdir -p \/pgbackup\necho \"\/dev\/vg_pgbackup\/lv_pgbackup   \/websrv01    ext4     defaults        0 0\" >> \/etc\/fstab\nmount -a\n                mkdir -p \/pgbackup\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureUsersAndGroups","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n#add groups\ngroupadd pgadmin\ngroupadd postgres\n\nchown -R postgres:pgadmin \/pgbackup\nchmod -R 775 \/pgbackup\n\nuseradd -u 1002 -g postgres -d \/home\/'@@{cred_postgres.username}@@' -s \/bin\/bash '@@{cred_postgres.username}@@'\necho \"@@{cred_postgres.username}@@:@@{cred_postgres.secret}@@\" | chpasswd\necho \"#POSTGRES CONFIG SUDOERS\" >> \/etc\/sudoers\necho \"@@{cred_postgres.username}@@  ALL=(ALL) NOPASSWD:ALL\" >> \/etc\/sudoers\necho \"session required pam_limits.so\" >> \/etc\/pam.d\/login   \n\nuseradd -u 1003 -g pgadmin -d \/home\/'@@{cred_appuser.username}@@' -s \/bin\/bash '@@{cred_appuser.username}@@'\necho \"@@{cred_appuser.username}@@:@@{cred_appuser.secret}@@\" | chpasswd\necho \"#APPUSER CONFIG SUDOERS\" >> \/etc\/sudoers\necho \"@@{cred_appuser.username}@@  ALL=(ALL) NOPASSWD:ALL\" >> \/etc\/sudoers\necho \"session required pam_limits.so\" >> \/etc\/pam.d\/login   \n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallHttpd","attrs":{"script":"#!\/bin\/bash\n\nsudo dnf install -y epel-release\nsudo dnf install -y wget\nsudo dnf install -y langpacks-en \nsudo dnf install -y glibc-all-langpacks\nsudo dnf install -y httpd \ntouch \/tmp\/01-web-packages.log\necho \"###############################\" > \/tmp\/01-web-packages.log\necho \"#         Packages            #\" >> \/tmp\/01-web-packages.log\necho \"###############################\" >> \/tmp\/01-web-packages.log\necho \"The pre-reqs packages for web are deployed\" >> \/tmp\/01-web-packages.log\n\nexit","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureHttp","attrs":{"script":"#!\/bin\/bash\n\nsudo systemctl enable httpd\nsudo systemctl start httpd\n#replace document root\n\nsudo systemctl restart httpd\n\nexit","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"59776499_runbook","main_task_local_reference":{"kind":"app_task","name":"bef6ae89_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"84854f2c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bcbc2861_runbook","main_task_local_reference":{"kind":"app_task","name":"84854f2c_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"4f960e67_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"vm_pgadmin"},"variable_list":[],"description":""}],"environment_reference_list":[],"patch_list":[],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"InstallPg"},{"kind":"app_task","name":"ConfigurePgAdminDB"},{"kind":"app_task","name":"InstallPgAdminSrv"},{"kind":"app_task","name":"InstallPgAdmin"},{"kind":"app_task","name":"Firewall"}],"name":"f23d65a7_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"InstallPg"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"ConfigurePgAdminDB"}},{"from_task_reference":{"kind":"app_task","name":"ConfigurePgAdminDB"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallPgAdminSrv"}},{"from_task_reference":{"kind":"app_task","name":"InstallPgAdminSrv"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"InstallPgAdmin"}},{"from_task_reference":{"kind":"app_task","name":"InstallPgAdmin"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Firewall"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallPg","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nsudo dnf install https:\/\/download.postgresql.org\/pub\/repos\/yum\/reporpms\/EL-8-x86_64\/pgdg-redhat-repo-latest.noarch.rpm -y\nsudo dnf -qy module disable postgresql -y\nsudo dnf update -y\nsudo dnf install postgresql13 postgresql13-server -y\nsudo \/usr\/pgsql-13\/bin\/postgresql-13-setup initdb\nsudo systemctl start postgresql-13\nsudo systemctl enable postgresql-13\n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_postgres"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigurePgAdminDB","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\npsql -c \"ALTER USER postgres WITH PASSWORD 'Nutanix\/4u';\"\n\ncat \/var\/lib\/pgsql\/13\/data\/pg_hba.conf\n\n#Create Database\npsql -c \"CREATE USER pgadmin WITH PASSWORD 'Nutanix\/4u';\"\npsql -c \"CREATE DATABASE h2sdb;\"\npsql -c \"GRANT ALL ON DATABASE h2sdb TO pgadmin;\"\npsql -c \"ALTER DATABASE h2sdb OWNER TO pgadmin;\"\n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_postgres"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallPgAdminSrv","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nsudo dnf install yum-utils -y\nsudo yum-config-manager --disable pgdg-common -y\nsudo rpm -i https:\/\/ftp.postgresql.org\/pub\/pgadmin\/pgadmin4\/yum\/pgadmin4-redhat-repo-2-1.noarch.rpm\nsudo dnf update -y\nsudo dnf install pgadmin4 -y\n\nsudo echo 'export PGADMIN_SETUP_EMAIL=\"appuser@nutanix.com\"' >> ~\/.bashrc\nsudo echo 'export PGADMIN_SETUP_PASSWORD=\"Nutanix\/4u\"' >> ~\/.bashrc\n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_appuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"InstallPgAdmin","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nsudo printf \"o\\nadmin@nutanix.com\\nBiturge02!03\\n\" | sudo \/usr\/pgadmin4\/bin\/setup-web.sh\n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_appuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Firewall","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nsudo firewall-cmd --zone=public --permanent --add-service=http\nsudo firewall-cmd --zone=public --permanent --add-service=https\nsudo firewall-cmd --reload\n\nexit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"cred_root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7ee3c2a2_runbook","main_task_local_reference":{"kind":"app_task","name":"f23d65a7_dag"},"variable_list":[]},"name":"InstallPgAdmin"}],"name":"Default","restore_config_list":[],"snapshot_config_list":[],"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"ntp2","value":"time.google.com","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"ntp1","value":"0.fr.pool.ntp.org","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"dns2","value":"10.42.47.52","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"dns1","value":"10.42.47.51","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MyDnsDomain","value":"nutalab.local","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"cred_root"},"type":"USER"},"name":"BP_PGSQL_PGADMIN"},"api_version":"3.0","metadata":{"last_update_time":"1635868351808768","kind":"blueprint","spec_version":16,"creation_time":"1635785672988958","categories":{"TemplateType":"Vm"},"name":"BP_PGSQL_PGADMIN"}}